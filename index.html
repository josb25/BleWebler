<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BleWebler - Open Source BLE Web Labeler</title>
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <div class="container">
    <header>
      <h1>BleWebler</h1>
      <p class="subtitle">Open Source BLE Web Labeler</p>
      <!-- Settings Button -->
      <button id="settingsBtn" class="btn btn-icon" style="position: absolute; top: 1rem; right: 1rem;"
        title="Paper Settings">
        <svg class="icon" viewBox="0 0 24 24">
          <path
            d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L5.09 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.58 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
        </svg>
      </button>
    </header>

    <main>
      <!-- Mode Selector -->
      <div class="label-type-selector">
        <button class="label-type-btn active" data-type="text">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M4 4h16v2H4V4zm6 4h4v12h-4V8z" />
          </svg> Text
        </button>
        <button class="label-type-btn" data-type="qrcode">
          <svg class="icon" viewBox="0 0 24 24">
            <path
              d="M3 3h8v8H3V3zm2 2v4h4V5H5zm8-2h8v8h-8V3zm2 2v4h4V5h-4zM3 13h8v8H3v-8zm2 2v4h4v-4H5zm8 2h2v2h-2v-2zm4 0h2v2h-2v-2zm-4 4h2v2h-2v-2zm2-2h2v2h-2v-2zm2 2h2v2h-2v-2z" />
          </svg> QR Code
        </button>
        <button class="label-type-btn" data-type="info">
          <svg class="icon" viewBox="0 0 24 24">
            <path
              d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
          </svg> Info
        </button>
      </div>

      <!-- Text Mode Options -->
      <section id="textOptions" class="card">
        <div class="canvas-container-wrapper" id="canvasWrapper">
          <div class="canvas-content">
            <canvas id="fabricCanvas" width="384" height="96"></canvas>
            <div id="resizeHandle" class="resize-handle hidden" title="Drag to resize">
              <svg class="icon" viewBox="0 0 24 24">
                <path
                  d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 10c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0-6c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z" />
              </svg>
            </div>
          </div>
        </div>

        <!-- General Controls -->
        <div id="general-controls-box">
          <div id="text-input-group" class="control-group">
            <button onclick="addTextToCanvas()" class="btn btn-icon" title="Add Text">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M5 4v3h5.5v12h3V7H19V4z" />
              </svg>
            </button>
            <button onclick="document.getElementById('imageUploadInput').click()" class="btn btn-icon btn-secondary"
              title="Upload Image">
              <svg class="icon" viewBox="0 0 24 24">
                <path
                  d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" />
              </svg>
            </button>
            <input type="file" id="imageUploadInput" accept="image/*" class="visually-hidden" />
            <button onclick="deleteSelectedObject()" class="btn btn-icon btn-danger" title="Delete Selected">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
              </svg>
            </button>
          </div>

          <div id="alignment-group" class="control-group">
            <div class="button-group flex-grow">
              <button onclick="setTextAlign('left')" class="btn" title="Align Left">
                <svg class="icon" viewBox="0 -960 960 960">
                  <path d="M80-80v-800h80v800H80Zm160-200v-120h400v120H240Zm0-280v-120h640v120H240Z" />
                </svg>
              </button>
              <button onclick="setTextAlign('center')" class="btn" title="Align Center">
                <svg class="icon" viewBox="0 -960 960 960">
                  <path
                    d="M440-80v-200H240v-120h200v-160H120v-120h320v-200h80v200h320v120H520v160h200v120H520v200h-80Z" />
                </svg>
              </button>
              <button onclick="setTextAlign('right')" class="btn" title="Align Right">
                <svg class="icon" viewBox="0 -960 960 960">
                  <path d="M800-80v-800h80v800h-80ZM320-280v-120h400v120H320ZM80-560v-120h640v120H80Z" />
                </svg>
              </button>
            </div>
            <div class="button-group flex-grow">
              <button onclick="setVerticalAlign('top')" class="btn" title="Align Top">
                <svg class="icon" viewBox="0 -960 960 960">
                  <path d="M280-80v-640h120v640H280Zm280-240v-400h120v400H560ZM80-800v-80h800v80H80Z" />
                </svg>
              </button>
              <button onclick="setVerticalAlign('middle')" class="btn" title="Align Middle">
                <svg class="icon" viewBox="0 -960 960 960">
                  <path
                    d="M280-120v-320H80v-80h200v-320h120v320h160v-200h120v200h200v80H680v200H560v-200H400v320H280Z" />
                </svg>
              </button>
              <button onclick="setVerticalAlign('bottom')" class="btn" title="Align Bottom">
                <svg class="icon" viewBox="0 -960 960 960">
                  <path d="M80-80v-80h800v80H80Zm200-160v-640h120v640H280Zm280 0v-400h120v400H560Z" />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Object Specific Controls -->
        <div id="object-specific-controls" class="mt-4">
          <div id="font-style-group" class="control-group">
            <input type="number" id="fontSize" value="48" min="1" title="Font Size" style="width: 80px;" />
            <input type="text" id="fontFamilyInput" list="fontList" value="Arial" placeholder="Font Family"
              class="flex-grow" />
            <datalist id="fontList"></datalist>
            <button id="loadSystemFontsBtn" class="btn btn-icon btn-secondary" title="Load System Fonts">
              <svg class="icon" viewBox="0 0 24 24">
                <path
                  d="M9.93 13.5h4.14L12 7.98zM20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-4.05 16.5l-1.14-3H9.17l-1.12 3H5.96l5.11-13h1.86l5.11 13h-2.09z" />
              </svg>
            </button>
          </div>

          <div id="text-format-group" class="button-group mb-4">
            <button class="toggle-btn btn" data-property="bold" title="Bold">
              <svg class="icon" viewBox="0 0 24 24">
                <path
                  d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z" />
              </svg>
            </button>
            <button class="toggle-btn btn" data-property="italic" title="Italic">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z" />
              </svg>
            </button>
            <button class="toggle-btn btn" data-property="underline" title="Underline">
              <svg class="icon" viewBox="0 0 24 24">
                <path
                  d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z" />
              </svg>
            </button>
          </div>

          <div id="image-controls-group" class="control-group" style="display: none;">
            <select id="ditheringAlgorithmSelect" title="Dithering Algorithm" class="flex-grow">
              <option value="none">No Dithering</option>
              <option value="floyd-steinberg">Floyd-Steinberg</option>
              <option value="atkinson">Atkinson</option>
              <option value="bayer">Bayer</option>
              <option value="binary-threshold">Binary Threshold</option>
            </select>
          </div>
        </div>
      </section>

      <div id="qrcodeOptions" class="card" style="display:none;">
        <p class="text-muted">Work in Progress.</p>
      </div>

      <div id="infoOptions" class="card" style="display:none;">
        <h3 class="canvas-content">Printer Information</h3>
        <pre id="printerInfoDisplay">
          Click to retrieve info...</pre>
        <button id="refreshInfoBtn" class="btn btn-secondary mt-2">Refresh Info</button>
      </div>

      <button id="printButton" class="btn btn-block" style="height: 3.5rem; font-size: 1.1rem;">
        Print!
      </button>

      <button class="advanced-toggle" onclick="toggleAdvanced()">Show Advanced</button>

      <div id="advancedSection" style="display: none;">
        <button onclick="disconnectPrinter()" class="btn btn-secondary btn-sm mt-4">Disconnect Printer</button>
        <pre id="logOutput"></pre>
      </div>
    </main>
    <!-- Printer Selection Modal -->
    <div id="startupModal" class="modal">
      <div class="modal-content">
        <h2>Setup Printer</h2>
        <div class="form-group">
          <p>Your selections will be saved in the URL.</p>
          <label for="printerSelect">Printer Model:</label>
          <select id="printerSelect"></select>
        </div>

        <div class="form-group">
          <label class="toggle-switch" style="justify-content: flex-start; gap: 10px;">
            <input type="checkbox" id="infinitePaperCheckbox">
            <span class="slider"></span>
            <span>Infinite Paper (Unlock Width)</span>
          </label>
        </div>

        <div class="form-group" id="paperWidthContainer">
          <label for="paperWidth">Paper Width (mm):</label>
          <input type="number" id="paperWidth" value="40" min="10" max="100">
        </div>

        <div class="form-group">
          <label for="paperHeight">Paper Height (mm):</label>
          <input type="number" id="paperHeight" value="12" min="10" max="300">
        </div>

        <button id="startBtn" class="btn btn-primary btn-block">Start Labeling</button>
      </div>
    </div>
  </div>

  <script src="js/printer_base.js" defer></script>
  <script src="js/marklife_p12.js" defer></script>
  <script src="js/printers_supported.js" defer></script>
  <script src="js/fabric.min.js" defer></script>
  <script src="js/fabric_editor.js" defer></script>
  <script src="js/ui.js" defer></script>
  <script src="js/utils.js" defer></script>
  <script src="js/dithering.js" defer></script>
</body>

</html>